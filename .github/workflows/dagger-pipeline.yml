# This file is generated by ci/generate-workflow.ts. DO NOT EDIT MANUALLY.

name: Dagger Pipeline

on:
  push:
    branches:
      - "feat/**"
      - "infra/**"
      - "agent/**"
      - "ta"
  pull_request:
    branches:
      - "ta"
  workflow_dispatch:
    inputs:
      branch:
        description: "Branch name to simulate"
        required: true
        default: "feat/test"

jobs:
  dagger-pipeline:
    name: "Dagger Pipeline: ${{ github.ref_name }}"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: "1.0.25"

      - name: Install dependencies
        run: bun install

      - name: Install Dagger CLI
        uses: dagger/dagger-for-github@v7
        with:
          version: "0.11.9"

      - name: Run Dagger Pipeline
        env:
          DAGGER_LOG_FORMAT: plain
          DAGGER_LOG_LEVEL: info
        run: "bun ci/dagger.ts \\\n  --branch \"${{ github.ref_name }}\" \\\n  --base-branch \"${{ github.base_ref || 'ta' }}\" \\\n  --github-event-name \"${{ github.event_name }}\"\n"

      - name: Cleanup agent sandbox (on branch delete)
        if: github.event_name == 'delete' && startsWith(github.ref, 'refs/heads/agent/')
        run: "echo \"üóëÔ∏è  Branch deleted, cleaning up agent sandbox...\" # This would trigger sandbox deletion via webhook or scheduled job # For now, log the action echo \"Sandbox cleanup triggered for: ${{ github.ref }}\""
